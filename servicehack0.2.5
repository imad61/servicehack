var sdcard = android.os.Environment.getExternalStorageDirectory();
var File = java.io.File;
var FileReader = java.io.FileReader;
var BufferedReader = java.io.BufferedReader;
var FOS = java.io.FileOutputStream;
var String = java.lang.String;
var StringBuilder = java.lang.StringBuilder;
var MediaPlayer = android.media.MediaPlayer();
var file = {
select:function(dir, fileName)
{
return (new File(dir, fileName));
},
exists:function(selectedFile)
{
return selectedFile.exists();
},
create:function(selectedFile)
{
selectedFile.createNewFile();
return selectedFile;
},
del:function(selectedFile)
{
selectedFile.delete();
},
read:function(selectedFile)
{
var readed = (new BufferedReader(new FileReader(selectedFile)));
var data = new StringBuilder();
var string;
while((string = readed.readLine()) != null){
data.append(string);
data.append('\n');
}
return data.toString();
},
readLine:function(selectedFile, line)
{
var readT = new file.read(selectedFile);
var lineArray = readT.split('\n');
return lineArray[line - 1];
},
readKey:function(selectedFile, key, keySeparator)
{
var isText = 0;
var textR = new file.read(selectedFile);
var splitTextR = textR.split('\n');
for(var i = 0; i < splitTextR.length; i++)
{
var textRF = splitTextR[i].split(keySeparator);
if(textRF[0] == key)
{
return textRF[1];
isText = 1;
break;
}
if(!isText)
{
return '[Unknown]';
}
}
},
write:function(selectedFile, text)
{
file.rewrite(selectedFile, (new file.read(selectedFile)) + text);
},
rewrite:function(selectedFile, text)
{
var writeFOS = new FOS(selectedFile);
writeFOS.write(new String(text).getBytes());
},
writeKey:function(selectedFile, key, keyText, keySeparator)
{
var isText = 0;
var textR = new file.read(selectedFile);
var splitTextR = textR.split('\
');
for(var i = 0; i < splitTextR.length; i++)
{
var textRF = splitTextR[i].split(keySeparator);
if(textRF[0] == key)
{
var splitWithKey = textR.split(key + keySeparator + new file.readKey(selectedFile, key));
file.rewrite(selectedFile, splitWithKey[0] + key + keySeparator + keyText + splitWithKey[1]);
isText = 1;
break;
}
}
if(!isText)
{
file.write(selectedFile, key + keySeparator + keyText);
}
},
mPlay:function(musicPath)
{
MediaPlayer.setDataSource(musicPath);
MediaPlayer.prepare();
MediaPlayer.start();
},
mStop:function()
{
MediaPlayer.reset();
}
};


var fstart=false;
var config = new file.select(sdcard,"/games/com.mojang/servicehack/config.dat");
var configdir = new file.select(sdcard,"/games/com.mojang/servicehack/");
function configer(){
	configdir.mkdir();
	file.create(config);
	
	}
if(file.exists(config)==false){configd1();}
	
	
	


/*Example - write text*/
//Language
var lang = 0;
var About = "This Mod is by\n GodGamer029 and SoftGameRat\n\nThis Mod is developed with ModPE IDE Pro\naviable in Google Play store\n\nThanks to Killerbls for the great GUI Examples."
var GUI;
var i= 1;
//update
var ver = "0.2.5";
      var menu;
      var exitUI;
      //sprint
      var sprinter = 0;
      var px, py, pz;
      var Xdiff, Zdiff;
     //Configuration
     var titlesize = 20,titlegravity = android.view.Gravity.CENTER;
     
      //Functions...
      function configd1(){
try{
var ctx = com.mojang.minecraftpe.MainActivity.currentMainActivity.get();
var alert = new android.app.AlertDialog.Builder(ctx);


      
     // alert.setGravity(android.view.Gravity.CENTER);
      var scroll = new android.widget.ScrollView(ctx);
      var layout = new android.widget.LinearLayout(ctx);
      layout.setOrientation(1);
      var note = new android.widget.TextView(ctx); 
      var lange = new android.widget.TextView(ctx); 
      var lango= new android.widget.TextView(ctx); 
      lange.setText("English");
      lango.setText("Language:");
      lange.setTextSize(18);
      lango.setTextSize(18);
      lange.setGravity(android.view.Gravity.CENTER);
      lango.setGravity(android.view.Gravity.CENTER);
      note.setText('Title Size:'); 
alert.setTitle("                   Configuration ");
      alert.setCancelable(false);
 
      note.setTextColor(android.graphics.Color.WHITE);

      note.setTextSize(18);
      note.setGravity(android.view.Gravity.CENTER);
     var sbpProgress = 0;
      var sbp = new android.widget.SeekBar(ctx);
      sbp.setMax(1);
      sbp.setProgress(sbpProgress);
      sbp.setOnSeekBarChangeListener(new android.widget.SeekBar.OnSeekBarChangeListener()
      {
      onStopTrackingTouch: function(view)
      {
      sbpProgress=sbp.getProgress();
      if(sbpProgress==0)
      {
     lange.setText("English");
      }
      if(sbpProgress==1)
      {
     lange.setText("German");
      }
      }
      });
      
//Example↓↓↓
      var abouttsize = new android.widget.EditText(ctx); 
      abouttsize.setGravity(android.view.Gravity.CENTER);
  //    ctitel.setGravity(android.view.Gravity.CENTER);
      abouttsize.setHint('Standard is 20'); 
      var params = new android.view.ViewGroup.LayoutParams(-2, -3); 
    //  layout.addView(note,params); 
     // layout.addView(abouttsize,params);
     abouttsize.setText("20");
     layout.addView(note); 
     layout.addView(abouttsize); 
     layout.addView(lango);
     	layout.addView(sbp);
     	layout.addView(lange);
      alert.setView(layout); }catch(e){
      	
      	print("1: " + e);
      	}
      	try{
      alert.setPositiveButton('Save', new android.content.DialogInterface.OnClickListener(){ 
      onClick: function(viewarg){
      	try{
      titlesize=parseInt(abouttsize.getText.toString());
      print(abouttsize.getText.toString());
      lang=sbpProgress;
  } catch(e){
  	print(e);
  	}
      }});
      
      alert.setNegativeButton("Don't configurate!", new android.content.DialogInterface.OnClickListener(){ 
      onClick: function(viewarg){
      //Your Code Here...
      
      }});
    }catch(e){
      print("2 "+e);}
      try{
       
      ctx.runOnUiThread(new java.lang.Runnable({ run: function(){
      var dialog = alert.create();
      dialog.show();
}}));}catch(e){

print("3: "+e);}
}
      function dip2px(dips){
      var ctx = com.mojang.minecraftpe.MainActivity.currentMainActivity.get();
      return Math.ceil(dips * ctx.getResources().getDisplayMetrics().density);
      }
      
      
      var ctx = com.mojang.minecraftpe.MainActivity.currentMainActivity.get();
      ctx.runOnUiThread(new java.lang.Runnable({ run: function(){
      try{
      var layout = new android.widget.LinearLayout(ctx);
      layout.setOrientation(1);
      var menuBtn = new android.widget.Button(ctx);
      menuBtn.setText('[SH]');
      menuBtn.setTextColor(
android.graphics.Color.parseColor("#0000ff")); 
      menuBtn.setOnClickListener(new android.view.View.OnClickListener({
      onClick: function(viewarg){
      mainMenu();
      exit();
      }
      }));
      layout.addView(menuBtn);
      GUI = new android.widget.PopupWindow(layout, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT, android.widget.RelativeLayout.LayoutParams.WRAP_CONTENT);
      GUI.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.TRANSPARENT));
      GUI.showAtLocation(ctx.getWindow().getDecorView(), android.view.Gravity.RIGHT | android.view.Gravity.TOP, 300, 0);
      }catch(err){
      print('An error occured: ' + err);
      }
      }}));
      
       function mainMenu(){
      var ctx = com.mojang.minecraftpe.MainActivity.currentMainActivity.get();
      ctx.runOnUiThread(new java.lang.Runnable({ run: function(){
      try{
      var menuLayout = new android.widget.LinearLayout(ctx);
      var menuScroll = new android.widget.ScrollView(ctx);
      var menuLayout1 = new android.widget.LinearLayout(ctx);
      menuLayout.setOrientation(1);
      menuLayout1.setOrientation(1);
      menuScroll.addView(menuLayout);
      menuLayout1.addView(menuScroll);
      //functions...
      function aboutmod(){
      	print(About);
      	}
      //textviews...
      var title = new android.widget.TextView(ctx);
      var sprinttext = new android.widget.TextView(ctx);
      title.setTextSize(titlesize);
      
      title.setText("Servicehack "+ver+"\n by GodGamer029 and SoftGameRat");
      if(sprinter!=0){
      sprinttext.setText("Sprint: "+sprinter);}else{sprinttext.setText("Sprint: "+-25);}
      title.setGravity(titlegravity);
      sprinttext.setGravity(android.view.Gravity.CENTER);
      title.setTextColor(
android.graphics.Color.parseColor("#2EFE2E"));
      
    //checker...
     
     
      //More buttons...
      var btnabout = new android.widget.Button(ctx);
      btnabout.setText('About');
      btnabout.setOnClickListener(new android.view.View.OnClickListener({
      onClick: function(viewarg){
      aboutmod();
      }
      }));
      //Seeker
      var sprint= new android.widget.SeekBar(ctx);
      sprint.setMax(99);
     // sprint.setMin(1);
     
      sprint.setProgress(sprinter);
/*      sprint.setOnSeekBarChangeListener(new android.widget.SeekBar.OnSeekBarChangeListener()
      {
      onStopTrackingTouch: function(view)
      {
      sprinter = sprint.getProgress();
      print(sprinter);
      }
      });*/
      sprint.setOnSeekBarChangeListener(new android.widget.SeekBar.OnSeekBarChangeListener(){
  
onStopTrackingTouch: function(view){

sprinter=sprint.getProgress();
	
sprinttext.setText("Sprint: "+(sprinter-25));

}});
      
//Example↓↓↓
      //Add Views
      menuLayout.addView(title);
      menuLayout.addView(sprinttext);
      menuLayout.addView(sprint);
      menuLayout.addView(btnabout);
      
      //something...
      menu = new android.widget.PopupWindow(menuLayout1, ctx.getWindowManager().getDefaultDisplay().getWidth()/2, ctx.getWindowManager().getDefaultDisplay().getHeight());
      menu.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.BLACK));
      menu.showAtLocation(ctx.getWindow().getDecorView(), android.view.Gravity.RIGHT | android.view.Gravity.TOP, 0, 0);
      }catch(error){
      print('An error occured: ' + error);
      }
      }}));
      }
      function exit(){
      var ctxe = com.mojang.minecraftpe.MainActivity.currentMainActivity.get();
      ctxe.runOnUiThread(new java.lang.Runnable({ run: function(){
      try{
      var xLayout = new android.widget.LinearLayout(ctxe);
      var xButton = new android.widget.Button(ctxe);
      xButton.setText('X');
      xButton.setTextSize(17);
      xButton.setBackgroundColor(android.graphics.Color.parseColor("#000000"));
      xButton.setTextColor(android.graphics.Color.RED);
      xButton.setOnClickListener(new android.view.View.OnClickListener({
      onClick: function(viewarg){
      exitUI.dismiss();
      menu.dismiss();
      }
      }));
      xLayout.addView(xButton);
      exitUI = new android.widget.PopupWindow(xLayout, dip2px(40), dip2px(40));
      exitUI.setBackgroundDrawable(new android.graphics.drawable.ColorDrawable(android.graphics.Color.TRANSPARENT));
      exitUI.showAtLocation(ctxe.getWindow().getDecorView(), android.view.Gravity.RIGHT | android.view.Gravity.TOP, 0, 0);
      }catch(exception){
      print(exception);
      }
      }}));
      }
      /*
      function leaveGame(){
      var ctx = com.mojang.minecraftpe.MainActivity.currentMainActivity.get();
      ctx.runOnUiThread(new java.lang.Runnable({ run: function(){
      if(GUI != null){
      GUI.dismiss();
      GUI = null;
      }
      if(menu != null){
      menu.dismiss();
      menu = null;
      }
      if(exitUI != null){
      exitUI.dismiss();
      exitUI = null;
      }
      }}));
      }
*/
	function modTick()
{
	if(sprinter!=0){
if(i==1)
    		  {
    		  
     		  px=getPlayerX();
     		  py=getPlayerY();
   		     pz=getPlayerZ();
  			     i = i + 1;
    		  }
    		  else if(i==3)
  		    {
     	   i=1;
  		      Xdiff=getPlayerX()-px;
     	   Zdiff=getPlayerZ()-pz;
     	   setVelX(getPlayerEnt(),Xdiff * ((sprinter+1) / 75));
     	   setVelZ(getPlayerEnt(),Zdiff * ((sprinter+1) / 75));
    		   Xdiff=0;
     	   Zdiff=0;
      }
 		 if(i!=1)
 		 {
  			i = i + 1;
  		 }
}
}
